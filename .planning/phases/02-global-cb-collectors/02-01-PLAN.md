---
phase: 02-global-cb-collectors
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [src/liquidity/collectors/fred.py, pyproject.toml, tests/integration/test_global_cb_collectors.py]
autonomous: true
---

<objective>
Extend FredCollector with ECB and BoJ total assets series available on FRED.

Purpose: Leverage existing FRED infrastructure for ECB (ECBASSETSW) and BoJ (JPNASSETS) totals without building new collectors. This gives immediate coverage for 2 major CBs with minimal code.

Output: FredCollector can fetch ECB/BoJ balance sheet totals, stored in QuestDB with appropriate units.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-global-cb-collectors/02-RESEARCH.md

# Prior work
@.planning/phases/01-foundation-core-data/01-02-SUMMARY.md

# Source files
@src/liquidity/collectors/fred.py
@src/liquidity/collectors/base.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extend SERIES_MAP with ECB/BoJ series</name>
  <files>src/liquidity/collectors/fred.py</files>
  <action>
Add ECB and BoJ total assets series to SERIES_MAP and UNIT_MAP in fred.py:

```python
SERIES_MAP.update({
    # Phase 2: Global CB totals via FRED
    "ecb_total_assets": "ECBASSETSW",  # Weekly, millions EUR
    "boj_total_assets": "JPNASSETS",   # Monthly, millions JPY
})

UNIT_MAP.update({
    "ECBASSETSW": "millions_eur",
    "JPNASSETS": "millions_jpy",
})
```

Add convenience methods to FredCollector class:
- `collect_ecb_assets(start_date, end_date)` - fetches ECBASSETSW
- `collect_boj_assets(start_date, end_date)` - fetches JPNASSETS
- `collect_global_cb_totals(start_date, end_date)` - fetches all CB totals (WALCL, ECBASSETSW, JPNASSETS)

Note: Values are in native currency (EUR, JPY). USD conversion happens in Phase 7 when FX collectors are ready.
  </action>
  <verify>
uv run python -c "from liquidity.collectors.fred import SERIES_MAP, UNIT_MAP; assert 'ECBASSETSW' in SERIES_MAP.values(); assert 'JPNASSETS' in SERIES_MAP.values()"
  </verify>
  <done>SERIES_MAP contains ECB/BoJ series, UNIT_MAP has correct units, convenience methods exist</done>
</task>

<task type="auto">
  <name>Task 2: Add integration tests for ECB/BoJ series</name>
  <files>tests/integration/test_global_cb_collectors.py</files>
  <action>
Create new test file for global CB collectors. Add tests that:
1. Verify ECBASSETSW series can be fetched (skip if no API key)
2. Verify JPNASSETS series can be fetched (skip if no API key)
3. Verify convenience methods work
4. Verify data has correct unit metadata

Use pytest.mark.skipif for missing FRED API key (same pattern as test_fred_collector.py).

Test data expectations:
- ECBASSETSW: Weekly data, positive values in millions EUR (typically 5-10 million = 5-10 trillion EUR)
- JPNASSETS: Monthly data, positive values in millions JPY (typically 700+ million = 700+ trillion JPY)
  </action>
  <verify>uv run pytest tests/integration/test_global_cb_collectors.py -v --tb=short</verify>
  <done>Integration tests exist and pass (or skip gracefully without API key)</done>
</task>

<task type="auto">
  <name>Task 3: Verify QuestDB storage works for new series</name>
  <files>tests/integration/test_global_cb_collectors.py</files>
  <action>
Add integration test that:
1. Fetches ECB/BoJ data
2. Stores to QuestDB via existing storage layer
3. Queries back and verifies units preserved

This validates the end-to-end flow: FRED -> Collector -> QuestDB -> Query.

Use existing QuestDB test fixtures from test_fred_collector.py if available, or skip if QuestDB not running.
  </action>
  <verify>uv run pytest tests/integration/test_global_cb_collectors.py::test_questdb_storage_ecb_boj -v --tb=short</verify>
  <done>ECB/BoJ data can be stored and retrieved from QuestDB with correct units</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `uv run ruff check src/liquidity/collectors/fred.py` passes
- [ ] `uv run mypy src/liquidity/collectors/fred.py` passes
- [ ] `uv run pytest tests/integration/test_global_cb_collectors.py -v` passes or skips gracefully
- [ ] FredCollector can fetch ECBASSETSW and JPNASSETS series
</verification>

<success_criteria>

- SERIES_MAP extended with ECB/BoJ series
- UNIT_MAP has millions_eur and millions_jpy
- Convenience methods added for collecting CB assets
- Integration tests cover new series
- All linting/type checking passes
</success_criteria>

<output>
After completion, create `.planning/phases/02-global-cb-collectors/02-01-SUMMARY.md`
</output>
