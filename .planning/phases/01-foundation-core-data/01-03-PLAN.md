---
phase: 01-foundation-core-data
plan: 03
type: execute
wave: 3
depends_on: ["01-02"]
files_modified:
  - src/liquidity/collectors/yahoo.py
  - src/liquidity/collectors/fred.py
  - tests/integration/test_market_collectors.py
  - tests/unit/test_calculations.py
autonomous: true
---

<objective>
Market indicators collectors: MOVE, VIX, yield curve, and credit spreads.

Purpose: Complete Phase 1 data collection by adding volatility (MOVE, VIX), yield curve (2Y, 10Y, spread), and credit spreads (IG, HY OAS). These are critical for regime classification and market stress detection.

Output: All Phase 1 collectors working, data flowing to QuestDB, comprehensive test coverage for data pipeline.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-core-data/01-RESEARCH.md
@.planning/phases/01-foundation-core-data/01-CONTEXT.md
@.planning/phases/01-foundation-core-data/01-02-SUMMARY.md

# From Apps Script v3.4.1:
# VIX: VIXCLS (FRED)
# VIX3M: VXVCLS (FRED)
# MOVE: Yahoo Finance (^MOVE)
# Yield spread: T10Y2Y (FRED)
# Credit spreads: BAMLH0A0HYM2 (HY OAS), BAMLC0A0CM (IG OAS)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extend FRED collector with volatility and yield series</name>
  <files>src/liquidity/collectors/fred.py</files>
  <action>
    Extend FredCollector.SERIES_MAP with additional series:

    Volatility:
    - "vix": "VIXCLS" (VIX from FRED)
    - "vix3m": "VXVCLS" (VIX3M for term structure)

    Yield Curve:
    - "dgs2": "DGS2" (2-Year Treasury)
    - "dgs10": "DGS10" (10-Year Treasury)
    - "t10y2y": "T10Y2Y" (10Y-2Y Spread, pre-calculated)

    Credit Spreads:
    - "hy_oas": "BAMLH0A0HYM2" (High Yield OAS)
    - "ig_oas": "BAMLC0A0CM" (Investment Grade OAS)

    Add calculate_yield_spread(df) method:
    - Yield Spread = DGS10 - DGS2
    - Useful for custom calculations if T10Y2Y unavailable

    Add collect_volatility() convenience method:
    - Fetches only VIX, VIX3M series
    - Returns DataFrame

    Add collect_yields() convenience method:
    - Fetches yield curve series
    - Returns DataFrame

    Add collect_credit() convenience method:
    - Fetches credit spread series
    - Returns DataFrame
  </action>
  <verify>uv run python -c "from liquidity.collectors.fred import FredCollector; c = FredCollector(); print(c.SERIES_MAP)"</verify>
  <done>FRED collector has all required series, convenience methods work</done>
</task>

<task type="auto">
  <name>Task 2: Create Yahoo Finance collector for MOVE index</name>
  <files>src/liquidity/collectors/yahoo.py</files>
  <action>
    Implement yahoo.py with YahooCollector extending BaseCollector:

    SYMBOLS constant:
    - "move": "^MOVE" (MOVE Bond Volatility Index)

    collect(symbols, period="5y") method:
    - Use OpenBB: obb.equity.price.historical(symbol, provider="yfinance")
    - Wrap in asyncio.to_thread() for async compatibility
    - Return DataFrame with date, symbol, close columns
    - Handle Yahoo Finance API quirks (rate limits, missing data)

    get_current_price(symbol) method:
    - Fetch latest price only (period="5d")
    - Return most recent close

    Note: Apps Script v3.4.1 uses Yahoo v8 Chart API directly.
    OpenBB abstracts this - use OpenBB for consistency.
    If OpenBB yfinance provider fails for MOVE, fall back to direct API.

    Register collector with registry.
  </action>
  <verify>uv run python -c "from liquidity.collectors.yahoo import YahooCollector; c = YahooCollector()"</verify>
  <done>Yahoo collector fetches MOVE index data</done>
</task>

<task type="auto">
  <name>Task 3: Create integration tests for all market collectors</name>
  <files>tests/integration/test_market_collectors.py, tests/unit/test_calculations.py</files>
  <action>
    Create test_market_collectors.py with integration tests:

    test_fred_volatility_collector():
    - Fetch VIX, VIX3M for last 30 days
    - Verify data not empty
    - Verify reasonable value ranges (VIX: 10-80, VIX3M: 10-60)
    - Store in QuestDB, query back

    test_fred_yield_collector():
    - Fetch DGS2, DGS10, T10Y2Y for last 30 days
    - Verify spread calculation matches T10Y2Y
    - Store in QuestDB

    test_fred_credit_collector():
    - Fetch HY OAS, IG OAS for last 30 days
    - Verify reasonable ranges (HY: 200-1000bps, IG: 50-300bps)
    - Store in QuestDB

    test_yahoo_move_collector():
    - Fetch MOVE for last 30 days
    - Verify reasonable range (60-200)
    - Store in QuestDB

    test_full_phase1_pipeline():
    - Fetch ALL Phase 1 series
    - Store all in QuestDB
    - Query back and verify completeness
    - Calculate Net Liquidity
    - Verify QuestDB has data for all expected series

    Create test_calculations.py with unit tests:

    test_net_liquidity_calculation():
    - Known inputs → expected output
    - Use historical values from Apps Script comparison

    test_yield_spread_calculation():
    - DGS10=4.5, DGS2=4.0 → spread=0.5

    Mark integration tests with @pytest.mark.integration.
    Use pytest fixtures for collector instances and storage.
  </action>
  <verify>uv run pytest tests/ -v --ignore=tests/e2e (with Docker running)</verify>
  <done>All tests pass, Phase 1 data pipeline validated end-to-end</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] FRED collector fetches VIX, VIX3M, yields, credit spreads
- [ ] Yahoo collector fetches MOVE index
- [ ] All data stored in QuestDB
- [ ] Unit tests pass for calculations
- [ ] Integration tests pass for all collectors
- [ ] QuestDB contains complete Phase 1 dataset
</verification>

<success_criteria>
- All tasks completed
- FRED collector extended with volatility, yields, credit spreads
- Yahoo collector working for MOVE
- Integration tests validate full data pipeline
- Unit tests validate calculations
- Phase 1 requirements DATA-01, DATA-12, DATA-13, DATA-14, DATA-15 satisfied
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-core-data/01-03-SUMMARY.md`
</output>
