---
phase: 01-foundation-core-data
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - pyproject.toml
  - src/liquidity/__init__.py
  - src/liquidity/config.py
  - src/liquidity/collectors/__init__.py
  - src/liquidity/collectors/base.py
  - src/liquidity/collectors/registry.py
  - src/liquidity/storage/__init__.py
  - src/liquidity/storage/questdb.py
  - src/liquidity/storage/schemas.py
  - docker-compose.yml
  - .env.example
autonomous: true
---

<objective>
Project scaffolding and infrastructure foundation for Global Liquidity Monitor.

Purpose: Establish production-grade Python project structure with uv, configure Docker services (QuestDB, Redis, Prometheus), create base collector pattern with resilience (tenacity + circuit breaker), and set up QuestDB storage layer with ILP ingestion.

Output: Working project structure where `uv run python -c "from liquidity.collectors.base import BaseCollector"` succeeds, Docker services running, QuestDB accepting ILP connections.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-core-data/01-RESEARCH.md
@.planning/phases/01-foundation-core-data/01-CONTEXT.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Initialize Python project with uv and core dependencies</name>
  <files>pyproject.toml, .python-version</files>
  <action>
    Initialize uv project with Python 3.11+. Add core dependencies from RESEARCH.md:
    - openbb (data fetching)
    - questdb (ILP ingestion)
    - httpx (async HTTP)
    - tenacity (retry logic)
    - purgatory-circuitbreaker (circuit breaker)
    - redis[hiredis] (pub/sub, shared state)
    - prometheus-client (metrics)
    - pydantic-settings (configuration)

    Add dev dependencies:
    - pytest, pytest-asyncio, pytest-cov
    - ruff (linting)
    - mypy (type checking)

    Configure pyproject.toml with:
    - Project metadata (name=liquidity-monitor, version=0.1.0)
    - Python requires >=3.11
    - Ruff and mypy settings
    - Pytest configuration with asyncio_mode=auto
  </action>
  <verify>uv sync succeeds, uv run python --version shows 3.11+</verify>
  <done>pyproject.toml exists with all dependencies, uv.lock generated</done>
</task>

<task type="auto">
  <name>Task 2: Create project structure and configuration module</name>
  <files>src/liquidity/__init__.py, src/liquidity/config.py, .env.example</files>
  <action>
    Create src/liquidity/ package structure.

    Implement config.py with Pydantic Settings:
    - Settings class with typed configuration
    - FRED API key (from SOPS via pydantic-settings pattern)
    - QuestDB host/port (default localhost:9009)
    - Redis URL (default redis://localhost:6379)
    - Prometheus port (default 8000)
    - Circuit breaker settings (threshold=5, ttl=60)
    - Retry settings (max_attempts=5, exponential backoff)

    Use SettingsConfigDict for env_prefix="LIQUIDITY_".
    Load from .env file for local development.

    Create .env.example with all required variables (without secrets).
  </action>
  <verify>uv run python -c "from liquidity.config import settings; print(settings.questdb_host)"</verify>
  <done>Config loads successfully, .env.example documents all variables</done>
</task>

<task type="auto">
  <name>Task 3: Create base collector with resilience patterns</name>
  <files>src/liquidity/collectors/__init__.py, src/liquidity/collectors/base.py, src/liquidity/collectors/registry.py</files>
  <action>
    Create collectors package.

    Implement base.py with BaseCollector abstract class:
    - tenacity retry decorator with exponential backoff (1-60s, 5 attempts)
    - Retry on httpx.TimeoutException, httpx.ConnectError
    - before_sleep logging for retry visibility
    - Circuit breaker integration via purgatory AsyncCircuitBreakerFactory
    - Abstract collect() method for subclasses
    - fetch_with_retry() wrapper method combining retry + circuit breaker

    Implement registry.py with CollectorRegistry:
    - register(name, collector_class) method
    - get(name) method
    - list_collectors() method
    - Singleton pattern for global registry

    Follow pattern from RESEARCH.md code examples.
  </action>
  <verify>uv run python -c "from liquidity.collectors.base import BaseCollector; from liquidity.collectors.registry import registry"</verify>
  <done>BaseCollector importable, registry pattern working</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `uv sync` succeeds without errors
- [ ] `uv run python -c "from liquidity.config import settings"` works
- [ ] `uv run python -c "from liquidity.collectors.base import BaseCollector"` works
- [ ] `uv run ruff check src/` passes
- [ ] `uv run mypy src/` passes (or has only minor issues)
</verification>

<success_criteria>
- All tasks completed
- Python project initialized with uv
- Core dependencies installed
- Configuration module working with Pydantic Settings
- Base collector with retry + circuit breaker pattern
- Collector registry implemented
- Code passes linting and type checks
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-core-data/01-01-SUMMARY.md`
</output>
